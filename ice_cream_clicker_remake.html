<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アイスクリームクリッカー REMAKE</title>
    <link rel="icon" href="images/favicon_icecream_icon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-[#FFF5E1] text-[#5C3D2E] select-none">
    <div class="container mx-auto p-4 flex flex-col">
        <header class="text-center mb-4">
            <h1 id="ice-cream-count" class="text-5xl font-bold">0</h1>
            <p class="text-xl"><span id="ips-display">0</span> アイス / 秒</p>
            <div class="mt-2 text-lg flex justify-center items-center gap-4">
                <div>
                    <span id="fame-points" class="font-bold text-yellow-600">0</span> 名声ポイント
                </div>
                <div>(生産ボーナス: +<span id="fame-bonus">0</span>%)</div>
            </div>
             <div class="mt-2 space-x-2">
                <button id="show-achievements-btn" class="px-4 py-2 bg-yellow-400 rounded-lg shadow font-bold clickable">実績</button>
                <button id="save-btn" class="px-4 py-2 bg-blue-400 text-white rounded-lg shadow font-bold clickable">セーブ</button>
                <button id="load-btn" class="px-4 py-2 bg-green-400 text-white rounded-lg shadow font-bold clickable">ロード</button>
                <button id="import-btn" class="px-4 py-2 bg-purple-400 text-white rounded-lg shadow font-bold clickable">インポート</button>
            </div>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-grow min-h-0">
            <!-- Left Panel: Main Clicker -->
            <section id="main-clicker" class="section-panel rounded-2xl flex justify-center items-center clickable relative overflow-hidden">
                <img src="" alt="アイスクリーム" class="main-clicker-image">
            </section>

            <!-- Middle Panel: Buildings -->
            <section class="section-panel rounded-2xl flex flex-col">
                <h2 class="text-2xl font-bold text-center p-2 border-b-2 border-white">施設</h2>
                <div id="buildings-list" class="space-y-2 p-2 scrollable-content"></div>
            </section>

            <!-- Right Panel: Upgrades -->
            <section class="section-panel rounded-2xl flex flex-col">
                <h2 class="text-2xl font-bold text-center p-2 border-b-2 border-white">アップグレード</h2>
                <div class="scrollable-content p-2">
                    <h3 class="font-bold mb-1">ディッパー強化</h3>
                    <div id="click-upgrades-list" class="space-y-2 mb-4"></div>
                    <h3 class="font-bold mb-1">施設アンロック</h3>
                    <div id="unlock-list" class="space-y-2"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="hidden absolute bg-gray-800 text-white text-sm rounded-lg px-3 py-2 z-[200] pointer-events-none max-w-xs"></div>

    <!-- Save/Load Modal -->
    <div id="save-load-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[100] flex items-center justify-center p-4">
        <div class="bg-[#FFF5E1] p-4 rounded-xl shadow-2xl w-full max-w-lg border-4 border-yellow-400">
            <div class="flex justify-between items-center mb-4">
                <h2 id="save-load-title" class="text-3xl font-bold">セーブ</h2>
                <button id="close-save-load-modal" class="text-3xl font-bold clickable">&times;</button>
            </div>
            <div id="save-slots-container" class="space-y-3">
                <!-- Save slots will be generated by JS -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[150] flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="confirmation-message" class="text-lg mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirmation-no" class="px-6 py-2 bg-gray-300 rounded hover:bg-gray-400 transition-colors">いいえ</button>
                <button id="confirmation-yes" class="px-6 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">はい</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[120] flex items-center justify-center p-4">
        <div class="bg-[#FFF5E1] p-4 rounded-xl shadow-2xl w-full max-w-lg border-4 border-yellow-400">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-3xl font-bold">セーブデータ書き出し</h2>
                <button id="close-export-modal" class="text-3xl font-bold clickable">&times;</button>
            </div>
            <p class="mb-2 text-sm">以下のテキストをすべてコピーして、安全な場所に保管してください。</p>
            <textarea id="export-textarea" readonly class="w-full h-32 p-2 border rounded bg-white/50 font-mono text-xs"></textarea>
            <div class="mt-2 text-right">
                <button id="copy-export-data" class="px-4 py-2 bg-blue-500 text-white rounded shadow hover:opacity-80">コピー</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[120] flex items-center justify-center p-4">
        <div class="bg-[#FFF5E1] p-4 rounded-xl shadow-2xl w-full max-w-lg border-4 border-yellow-400">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-3xl font-bold">セーブデータ読み込み</h2>
                <button id="close-import-modal" class="text-3xl font-bold clickable">&times;</button>
            </div>
            <p class="mb-2 text-sm">書き出したセーブデータを以下に貼り付けてください。</p>
            <textarea id="import-textarea" class="w-full h-32 p-2 border rounded bg-white/50 font-mono text-xs" placeholder="ここにセーブデータを貼り付け..."></textarea>
             <div class="mt-4">
                <p class="text-sm mb-2 text-center font-bold">どのスロットにインポートしますか？</p>
                <div id="import-slots-container" class="flex justify-center gap-4">
                    <!-- Import slots will be generated by JS -->
                </div>
            </div>
            <div class="mt-4 text-right">
                <button id="import-data-btn" class="px-4 py-2 bg-green-500 text-white rounded shadow hover:opacity-80">読み込む</button>
            </div>
        </div>
    </div>

    <!-- Mission Result Popup -->
    <div id="mission-result-popup" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
        <div id="mission-result-content" class="content text-center p-8 rounded-2xl shadow-2xl">
            <h2 id="mission-result-title" class="text-4xl font-bold mb-4"></h2>
            <p id="mission-result-message" class="text-lg"></p>
        </div>
    </div>

    <!-- Debug Modal -->
    <div id="debug-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <h2 class="text-xl font-bold mb-4">デバッグコマンド</h2>
            <input type="text" id="debug-input" class="w-full p-2 border rounded mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex justify-end space-x-2">
                <button id="debug-cancel" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 transition-colors">キャンセル</button>
                <button id="debug-execute" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">実行</button>
            </div>
        </div>
    </div>
    
    <div id="achievements-panel" class="achievement-panel hidden">
        <div class="bg-[#FFF5E1] p-4 rounded-xl shadow-2xl w-full max-w-2xl h-[90vh] flex flex-col border-4 border-yellow-400">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-3xl font-bold">実績</h2>
                <button id="close-achievements-btn" class="text-3xl font-bold clickable">&times;</button>
            </div>
            <!-- Achievement Toggles -->
                        <div class="flex border-b-2 border-yellow-400 mb-2">
                <button id="toggle-main-achievements-btn" class="flex-1 p-2 font-bold text-lg focus:outline-none achievement-tab-btn active">通常実績</button>
                <button id="toggle-secret-achievements-btn" class="flex-1 p-2 font-bold text-lg focus:outline-none achievement-tab-btn hidden">隠し実績</button>
            </div>
            <div id="achievements-list" class="p-2 scrollable-content flex-grow"></div>
        </div>
    </div>

    <div id="achievement-toast" class="fixed right-5 bottom-5 z-[200] transition-transform duration-500 translate-y-[200%]">
        <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg border-2 border-yellow-400 flex items-center gap-4">
            <div class="text-3xl">🎉</div>
            <div>
                <h3 class="font-bold">実績解除</h3>
                <p id="toast-achievement-name"></p>
            </div>
        </div>
    </div>

    <!-- Info Toast -->
    <div id="info-toast" class="fixed right-5 bottom-5 z-[200] transition-transform duration-500 translate-y-[200%]">
        <div class="bg-blue-500 text-white p-4 rounded-xl shadow-lg border-2 border-blue-300 flex items-center gap-4">
            <div class="text-3xl">ℹ️</div>
            <div>
                <p id="toast-info-message"></p>
            </div>
        </div>
    </div>

    <div id="event-mission-panel" class="hidden fixed top-5 right-5 bg-yellow-100 border-4 border-yellow-400 p-4 rounded-xl shadow-2xl w-80 z-30 text-center">
        <h3 id="mission-name" class="text-xl font-bold mb-2">ミッション名</h3>
        <p id="mission-description" class="text-sm mb-3">ミッションの説明文がここに入ります。</p>
        <div class="w-full bg-gray-300 rounded-full h-4 mb-2">
            <div id="mission-progress-bar" class="bg-green-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
        <div class="flex justify-between items-center">
            <p id="mission-progress-text" class="text-sm font-bold">0 / 100</p>
            <p id="mission-timer" class="text-lg font-bold">00:00</p>
        </div>
    </div>

    <!-- 
      JavaScriptファイルの読み込み順序は重要です。
      1. 設定ファイル (settings, achievements, eventMissions)
      2. セーブ/ロード機能 (save.js)
      3. UI関連の専門家ファイル (他の専門家が利用するツールを提供するため)
      4. 計算や実績判定などのコアな専門家ファイル
      5. 全てを統括する司令塔ファイル (main.js)
    -->
    <script src="settings/settings.js"></script>
    <script src="settings/main-achievements.js"></script>
    <script src="settings/secret-achievements.js"></script>
    <script src="settings/eventMissions.js"></script>
    <script src="save.js"></script>
    <script src="core/ui-manager.js"></script> 
    <script src="core/core-logic.js"></script>
    <script src="core/achievements-logic.js"></script>
    <script src="core/missions-logic.js"></script>
    <script src="core/main.js"></script>
</body>
</html>
